# Firebase エミュレーターガイド

このドキュメントでは、ローカル開発環境でFirebase エミュレーターを使用する方法について説明します。

## 概要

Firebase エミュレーターを使用すると、実際のFirebaseプロジェクトに影響を与えることなく、ローカル環境でFirebaseサービス（Firestore、Authentication）を模倣できます。これにより、安全に開発やテストを行うことができます。

## 前提条件

- Node.js と pnpm がインストールされていること
- プロジェクトのルートディレクトリで `pnpm install` が実行済みであること

## エミュレーターの起動方法

### 基本的な起動

```bash
pnpm emulator:start
```

このコマンドは、Firestore と Authentication のエミュレーターを起動します。エミュレーターUIは http://localhost:4000 でアクセスできます。

### サンプルデータを使用した起動

以前に保存したエミュレーターデータを使用して起動する場合：

```bash
pnpm emulator:start-with-data
```

このコマンドは、`./emulator-data` ディレクトリからデータをインポートし、エミュレーターを終了する際に同じディレクトリにデータをエクスポートします。

### サンプルデータの生成

エミュレーターを起動した後、サンプルデータを生成するには：

```bash
pnpm emulator:seed
```

このコマンドは、サンプルの動画データをFirestoreエミュレーターに追加します。

### エミュレーターの起動とサンプルデータの生成を一度に行う

```bash
pnpm emulator:start-and-seed
```

このコマンドは、エミュレーターを起動し、5秒後にサンプルデータを生成します。

## エミュレーターデータのエクスポート

現在のエミュレーターの状態をエクスポートするには：

```bash
pnpm emulator:export-data
```

このコマンドは、現在のエミュレーターの状態を `./emulator-data` ディレクトリにエクスポートします。

## アプリケーションでのエミュレーターの使用

アプリケーションでエミュレーターを使用するには、`apps/web/.env.local` ファイルに以下の環境変数を設定します：

```
NEXT_PUBLIC_USE_EMULATOR=true
```

この設定により、アプリケーションはFirebaseの実際のサービスではなく、ローカルのエミュレーターに接続します。

## エミュレーターUIの使用方法

エミュレーターUIは http://localhost:4100 でアクセスできます。このUIでは以下のことができます：

- Firestoreデータの閲覧と編集
- Authentication ユーザーの管理
- エミュレーターのログの確認
- エミュレーターの設定

## トラブルシューティング

### エミュレーターが起動しない場合

- ポートが既に使用されている可能性があります。他のプロセスが使用しているポートを確認してください。
- Firebase CLIが正しくインストールされているか確認してください。

### アプリケーションがエミュレーターに接続しない場合

- `.env.local` ファイルが正しく設定されているか確認してください。
- エミュレーターが実行中であることを確認してください。
- ブラウザのコンソールでエラーメッセージを確認してください。

### サンプルデータが表示されない場合

- サンプルデータが正しく生成されたか確認してください。
- エミュレーターUIでFirestoreデータを確認してください。
- アプリケーションを再読み込みしてみてください。