# モノレポ構成とCloud Run移行 - 完了記録

**注: このドキュメントは歴史的記録として保存されています。2025年4月28日に移行は完了しました。**

## 移行の概要

2025年4月22日から28日にかけて、以下の移行を実施し完了しました：

1. ✅ **モノレポ構成への移行**: Webアプリコードを`apps/web`に分離
2. ✅ **Cloud Runへのホスティング移行**: Firebase Hostingから移行
3. ✅ **Terraformでのインフラ一元管理**: CI/CDパイプラインの整備

## 移行の背景と目的

以下の課題を解決するために移行を実施しました：

- Webアプリケーションコードとワークスペース管理の混同
- Firebase CLIとTerraformの混在による管理の複雑化
- 不要な機能（プレビューチャネルなど）による構成の複雑化

## モノレポ構成の概要

### 現在のディレクトリ構造

```
suzumina.click/
├── apps/
│   ├── web/              # Next.jsアプリケーション
│   └── functions/        # Firebase Functions（認証機能のみで使用）
├── packages/             # 共有コード用（将来的に使用予定）
├── terraform/            # インフラコード
└── docs/                 # ドキュメント
```

### 構成変更のポイント

- **モノレポ構造**: `pnpm-workspace.yaml`による管理
- **Firebase利用の最小化**: 認証機能のみを使用
- **開発環境の簡素化**: ステージング環境のみに集中

## 現行アーキテクチャ

- **ホスティング**: Cloud Run (Next.js standalone)
- **ビルドパイプライン**: Cloud Build + GitHub Actions
- **インフラ管理**: Terraform
- **パッケージ管理**: pnpm (モノレポ)
- **環境**: ステージング環境のみ

## 移行結果

### 達成された目標

- ✅ 明確なプロジェクト構造の確立
- ✅ デプロイプロセスの一元化
- ✅ 不要な機能・環境の削除

### 廃止された機能

- Firebase Hostingへのデプロイ
- プレビューチャネル
- 複数環境管理

## 詳細情報の参照先

移行に関する詳細情報は以下のドキュメントを参照してください：

- **[インフラ構成監査レポート](./INFRA_AUDIT.md)**: 現在のインフラ構成の詳細
- **[デプロイ手順マニュアル](./DEPLOYMENT.md)**: 現在のデプロイプロセス
- **[開発環境セットアップ](./DEVELOPMENT_SETUP.md)**: 開発環境の構築手順