# 設計・開発ポリシー

このドキュメントは、suzumina.click プロジェクトにおける設計および開発の基本方針を定めます。

## 1. 基本設計思想

- **サーバーコンポーネント (RSC) ファースト**:
  - Next.js App Router の機能を最大限活用し、デフォルトでサーバーコンポーネントを使用します。
  - `page.tsx` および `layout.tsx` は原則としてサーバーコンポーネントとします。
- **クライアントコンポーネント (RCC) の利用**:
  - インタラクティビティ（`useState`, `useEffect` など）やブラウザAPIへのアクセス、**Headless UI などのクライアントサイド前提のライブラリ**が必要な場合に限り、クライアントコンポーネント (`"use client"` ディレクティブを使用) を導入します。
  - **インサイドアウト・アプローチ**: クライアントコンポーネントは可能な限り小さく、ページの末端（リーフ）に近い部分で利用します。サーバーコンポーネント内にクライアントコンポーネントをインポートする形を基本とします。
- **コロケーション**:
  - 特定のページに強く関連づくコンポーネントは、そのページのディレクトリ配下に `_components` ディレクトリを作成し、そこに配置します。
  - 再利用性の高い共通コンポーネントは `apps/web/src/components` ディレクトリに配置します。

## 2. 使用技術スタック

- **フレームワーク**: Next.js `15.3.1` (App Router)
- **UI スタイリング**: TailwindCSS `4.1.4` + DaisyUI `5.0.27`
- **UI コンポーネント (スタイルなし)**: Headless UI `2.2.2`
- **言語**: TypeScript (`^5.8.3`)
- **テスト**: Vitest (`^3.1.2`), React Testing Library (RTL) (`^16.3.0`)
- **フォーマット/リント**: Biome (`^1.9.4`)
- **パッケージ管理**: pnpm (`^9.1.0`) + Workspaces
- **インフラストラクチャ**: Terraform, Google Cloud Run, Firebase Authentication

## 3. コーディング規約

- **命名規則**:
  - ファイル名、コンポーネント名: `PascalCase` (例: `UserProfile.tsx`)
  - 関数名、変数名: `camelCase` (例: `getUserData`)
  - 型名、インターフェース名: `PascalCase` (例: `UserInfo`)
  - **テストファイル**: `*.test.tsx` または `*.spec.tsx` (コンポーネントと同じディレクトリに配置)
- **フォーマット/リント**: Biome (`biome.json`) の設定に従います。`pnpm format` および `pnpm lint` (または `pnpm check`) を使用します。
- **コード品質** (`.clinerules` より):
  - 純粋関数、短い関数、単一責務の原則 (SRP) を意識します。
  - 可読性、保守性、テスト容易性を重視します。
  - コードの重複を避け、シンプルな設計を目指します。
- **コメント・ドキュメンテーション**:
  - コメント言語: **日本語** (`ja-JP`)
  - JSDoc スタイルでコンポーネントや関数の説明を記述します。
  - テストケースの説明も**日本語**で記述します。

## 4. スタイリング方針

- **DaisyUI 優先**: 原則として DaisyUI が提供するコンポーネントクラス (`btn`, `card` など) やユーティリティクラス (`bg-primary`, `text-center` など) を使用してスタイリングを行います。
- **TailwindCSS ユーティリティ**: DaisyUI で表現できない、または微調整が必要な場合に TailwindCSS のユーティリティクラスを使用します。
- **Headless UI のスタイリング**: Headless UI コンポーネントには Tailwind/DaisyUI クラスを適用してスタイリングします。
- **カスタムCSSの抑制**: `globals.css` は `@import "tailwindcss";` と `@plugin "daisyui" {...}` のみに限定し、原則として他のカスタムCSSは記述しません。

## 5. Git 利用方針

- **コミットメッセージ**: Conventional Commits 規約に従います (`.clinerules` より)。
  - `feat`: 新機能追加
  - `fix`: バグ修正
  - `docs`: ドキュメントのみの変更
  - `style`: コードの意味に影響しない変更（空白、フォーマット、セミコロンなど）
  - `refactor`: コードのリファクタリング
  - `test`: テストの追加・修正
  - `chore`: ビルドプロセスや補助ツールの変更
- **ブランチ戦略**: GitHub Flow を採用します。
  - `main` ブランチは常にデプロイ可能な状態を保ちます。
  - 機能追加やバグ修正は、`main` ブランチから切ったフィーチャーブランチで行います。
  - フィーチャーブランチ名は、`feat/issue-123-add-login-button` や `fix/issue-456-header-layout` のように、種類、関連Issue番号（あれば）、内容がわかるように命名します。
- **プルリクエスト (PR)**:
  - フィーチャーブランチから `main` ブランチへのマージは、必ずプルリクエストを作成して行います。
  - プルリクエストは、原則として1つの関心事（1つの機能追加、1つのバグ修正など）に対応するようにします。
  - プルリクエストには、変更内容や目的を明確に記述します。
  - 完成後、メインブランチからステージング環境にデプロイします。

## 6. テスト方針

- **テストランナー**: Vitest を使用します。
- **テストライブラリ**: 主に React Testing Library (RTL) を使用して、ユーザーの視点に近いコンポーネントテストを作成します。
- **テストファイル**: テスト対象のコンポーネントファイルと同じディレクトリに `*.test.tsx` または `*.spec.tsx` という命名規則で配置します。
- **テストの種類と焦点**:
  - **ユニットテスト**: ヘルパー関数やカスタムフックなど、UI に直接関わらないロジックのテスト。
  - **コンポーネントテスト (RTL)**: コンポーネントが正しくレンダリングされ、ユーザーインタラクションに対して期待通りに動作するかをテストします。内部実装の詳細ではなく、コンポーネントの振る舞いに焦点を当てます。
  - **E2Eテスト**: (必要に応じて導入) Playwright や Cypress を使用し、実際のブラウザ環境でユーザーシナリオ全体をテストします。
- **基本方針** (`.clinerules` より): Red-Green-Refactor サイクルを意識します。
- **テストパターン** (`.clinerules` より): Arrange-Act-Assert (AAA) パターンを使用します。
- **カバレッジ目標** (`.clinerules` より): 80% 以上を目指します (テスト実装時に有効化)。

## 7. モノレポ開発の方針

- **ディレクトリ構造**:
  - `apps/web/`: Next.jsフロントエンドアプリケーション
  - `apps/functions/`: Firebase Cloud Functions（認証機能のみ）
  - `packages/`: 共有パッケージ（将来的に使用）
- **ワークスペース操作**:
  - `pnpm --filter @suzumina.click/web <コマンド>` のようにワークスペース指定で操作します。
  - ルートディレクトリの `package.json` に定義されたエイリアスを使用できます。
- **依存関係管理**:
  - 共有パッケージは `packages/` ディレクトリに配置し、内部依存関係として参照します。
  - パッケージ間の依存関係は明示的に宣言します。

## 8. ドキュメント管理

- **TODO管理**: `docs/TODO.md` にてタスクをチェックリスト形式で管理します。
- **ドキュメント更新**: コード変更に伴い、関連するドキュメントも適宜更新します。
- **Markdown 行数**: 100行以内を目安とし、簡潔さを保ちます (`.clinerules` より)。不要になったドキュメントは削除します。
- **言語**: ドキュメントは原則として日本語で記述します。

## 9. デプロイと環境

- **環境**: ステージング環境のみで開発を行います。
- **デプロイ方法**: GitHub Actionsワークフローを使用し、Cloud Build経由でCloud Runにデプロイします。
- **リソース管理**: すべてのインフラリソースはTerraformで管理します。
- **詳細**: デプロイの詳細な手順については `DEPLOYMENT.md` を参照してください。
