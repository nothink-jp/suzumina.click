# æœ€é©åŒ–ã•ã‚ŒãŸlefthookè¨­å®šï¼ˆå†—é•·æ€§é™¤å»ç‰ˆï¼‰

pre-commit:
  commands:
    # 1. ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ»ãƒªãƒ³ãƒˆ (Biome) - å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿é«˜é€Ÿå®Ÿè¡Œ
    check:
      glob: "*.{js,ts,cjs,mjs,d.cts,d.mts,jsx,tsx,json,jsonc}"
      run: npx @biomejs/biome check --write --no-errors-on-unmatched --files-ignore-unknown=true --colors=off {staged_files}
      stage_fixed: true
      fail_text: "ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ»ãƒªãƒ³ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ"
    
    # 2. å¤‰æ›´ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œï¼ˆé«˜é€ŸåŒ–ï¼‰
    test:
      glob: "*.{ts,tsx,js,jsx}"
      run: pnpm test --run --reporter=verbose --passWithNoTests
      fail_text: "ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸ"

pre-push:
  commands:
    # Session Branchæˆ¦ç•¥æ¨å¥¨è­¦å‘Š
    branch-strategy-warning:
      run: |
        BRANCH=$(git rev-parse --abbrev-ref HEAD)
        if [ "$BRANCH" = "main" ]; then
          echo ""
          echo "âš ï¸  è­¦å‘Š: mainãƒ–ãƒ©ãƒ³ãƒã«ç›´æ¥pushã—ã¦ã„ã¾ã™"
          echo ""
          echo "ğŸ”„ Session Branchæˆ¦ç•¥ã®ä½¿ç”¨ã‚’æ¨å¥¨ã—ã¾ã™:"
          echo "  1. git claude-start    # ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ï¼ˆãƒ–ãƒ©ãƒ³ãƒä½œæˆï¼‰"
          echo "  2. (é–‹ç™ºä½œæ¥­ã‚’å®Ÿè¡Œ)"
          echo "  3. git claude-done     # ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†ï¼ˆãƒãƒ¼ã‚¸ãƒ»å‰Šé™¤ï¼‰"
          echo ""
          echo "ğŸ’¡ ãƒ¡ãƒªãƒƒãƒˆ:"
          echo "  - ã‚»ãƒƒã‚·ãƒ§ãƒ³å˜ä½ã®å±¥æ­´ç®¡ç†"
          echo "  - ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®¹æ˜“"
          echo "  - ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç’°å¢ƒé€£æºï¼ˆå°†æ¥å®Ÿè£…ï¼‰"
          echo ""
          echo "â±ï¸  3ç§’å¾Œã«pushã‚’ç¶šè¡Œã—ã¾ã™..."
          sleep 3
        fi
    
    # 1. å…±æœ‰å‹ã®ãƒ“ãƒ«ãƒ‰ç¢ºèªï¼ˆä¾å­˜é–¢ä¿‚ã®æ•´åˆæ€§ä¿è¨¼ï¼‰
    build-shared-types:
      run: pnpm --filter @suzumina.click/shared-types build
      fail_text: "å…±æœ‰å‹ã®ãƒ“ãƒ«ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ"
    
    # 2. å…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å‹ãƒã‚§ãƒƒã‚¯ï¼ˆpre-commitã§ã¯å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ï¼‰
    typecheck:
      run: pnpm typecheck
      fail_text: "TypeScriptå‹ãƒã‚§ãƒƒã‚¯ã«å¤±æ•—ã—ã¾ã—ãŸ"
    
    # 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ï¼ˆãƒ—ãƒƒã‚·ãƒ¥å‰ã®æœ€çµ‚ç¢ºèªï¼‰
    audit:
      run: pnpm audit --audit-level moderate
      fail_text: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ"
    
    # 4. ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèªï¼ˆå“è³ªä¿è¨¼ï¼‰
    test-coverage:
      run: pnpm test:coverage
      fail_text: "ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãŒåŸºæº–ã‚’æº€ãŸã—ã¦ã„ã¾ã›ã‚“"
