# DLsiteãƒ‘ãƒ¼ã‚µãƒ¼é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°ã‚¬ã‚¤ãƒ‰

DLsiteãƒ‘ãƒ¼ã‚µãƒ¼ã®é–‹ç™ºãƒ»æ”¹å–„ãƒ»ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚ã®åŒ…æ‹¬çš„ãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã§ã™ã€‚

## ğŸ¯ æ¦‚è¦

DLsiteã®HTMLæ§‹é€ å¤‰åŒ–ã«ã‚ˆã‚Šãƒ‘ãƒ¼ã‚µãƒ¼ãŒæ­£å¸¸ã«å‹•ä½œã—ãªã„å ´åˆã®èª¿æŸ»ãƒ»ä¿®æ­£ã‚’åŠ¹ç‡åŒ–ã™ã‚‹ãƒ„ãƒ¼ãƒ«ç¾¤ã§ã™ã€‚

## ğŸ› ï¸ åˆ©ç”¨å¯èƒ½ãªãƒ„ãƒ¼ãƒ«

### 1. ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆï¼ˆæ¨å¥¨ãƒ»æœ€åˆã«ä½¿ç”¨ï¼‰

å®Ÿéš›ã®DLsiteä½œå“ã‚’ä½¿ã£ã¦ç´ æ—©ããƒ‘ãƒ¼ã‚µãƒ¼ã®å‹•ä½œç¢ºèªã‚’è¡Œã„ã¾ã™ã€‚

```bash
# å…¨ã‚µãƒ³ãƒ—ãƒ«ä½œå“ã®ãƒ†ã‚¹ãƒˆ
cd apps/functions
pnpm debug:quick

# ç‰¹å®šã®ä½œå“IDã‚’ãƒ†ã‚¹ãƒˆ
pnpm debug:quick RJ01052559
```

**å‡ºåŠ›ä¾‹:**
```
ğŸ§ª Testing RJ01052559...
  ğŸ“¥ Fetching page...
  ğŸ“„ HTML received: 45231 characters
  ğŸ”§ Parsing detail data...
  ğŸ”§ Testing search parser...
  âœ… Success! Data summary:
    ğŸ“€ Tracks: 5
    ğŸ“ File info: âœ“
    ğŸ‘¥ Creator info: âœ“
    ğŸ Bonus content: âœ—
    ğŸ–¼ï¸  High-res image: âœ“
    ğŸ“ Description: âœ“
```

### 2. ğŸ” è©³ç´°ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«

ã‚ˆã‚Šè©³ç´°ãªåˆ†æã¨HTMLãƒ€ãƒ³ãƒ—æ©Ÿèƒ½ä»˜ãã®ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã€‚

```bash
# ã‚µãƒ³ãƒ—ãƒ«ãƒšãƒ¼ã‚¸ã®ãƒãƒƒãƒãƒ†ã‚¹ãƒˆ
pnpm debug:parser

# ç‰¹å®šä½œå“ã®è©³ç´°ãƒ†ã‚¹ãƒˆ  
pnpm debug:parser --product-id RJ123456

# ãƒ­ãƒ¼ã‚«ãƒ«HTMLãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆ
pnpm debug:parser --html-file ./debug-output/sample.html

# å¤±æ•—åˆ†æãƒ¬ãƒãƒ¼ãƒˆ
pnpm debug:parser --analyze-failures
```

**å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«:**
- `debug-output/{productId}_raw.html` - å–å¾—ã—ãŸç”Ÿã®HTML
- `debug-output/{productId}_result.json` - æŠ½å‡ºçµæœã®è©³ç´°
- `debug-output/test_summary.json` - å…¨ä½“ã‚µãƒãƒªãƒ¼

### 3. ğŸ“Š HTMLæ§‹é€ å¤‰åŒ–ç›£è¦–

DLsiteã®HTMLæ§‹é€ å¤‰åŒ–ã‚’ç¶™ç¶šçš„ã«ç›£è¦–ã—ã€ãƒ‘ãƒ¼ã‚µãƒ¼ä¿®æ­£ã®å¿…è¦æ€§ã‚’æ—©æœŸæ¤œå‡ºã—ã¾ã™ã€‚

```bash
# ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ä½œæˆï¼ˆåˆå›ï¼‰
pnpm debug:baseline

# ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã¨ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚’æ¯”è¼ƒ
pnpm debug:compare

# ç¶™ç¶šç›£è¦–é–‹å§‹ï¼ˆ1æ™‚é–“é–“éš”ï¼‰
pnpm debug:monitor

# 30åˆ†é–“éš”ã§ç›£è¦–
pnpm debug:monitor --interval 30
```

## ğŸ“ ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

```
apps/functions/debug-output/
â”œâ”€â”€ baselines/              # HTMLæ§‹é€ ã®ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³
â”‚   â”œâ”€â”€ RJ123456_baseline.json
â”‚   â””â”€â”€ RJ123456_baseline.html
â”œâ”€â”€ change-reports/         # å¤‰åŒ–æ¤œå‡ºãƒ¬ãƒãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ RJ123456_change_1234567890.json
â”‚   â””â”€â”€ overall_report_1234567890.json  
â”œâ”€â”€ RJ123456_raw.html      # å–å¾—ã—ãŸHTML
â”œâ”€â”€ RJ123456_result.json   # ãƒ‘ãƒ¼ã‚¹çµæœ
â””â”€â”€ test_summary.json      # ãƒ†ã‚¹ãƒˆå…¨ä½“ã‚µãƒãƒªãƒ¼
```

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ‰‹é †

### 1. ãƒ‘ãƒ¼ã‚µãƒ¼ãŒå‹•ä½œã—ãªã„å ´åˆ

```bash
# Step 1: ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆã§ç¾çŠ¶ç¢ºèª
pnpm debug:quick

# Step 2: ç‰¹å®šã®ä½œå“ã§è©³ç´°ç¢ºèª
pnpm debug:parser --product-id <å¤±æ•—ã—ãŸID>

# Step 3: HTMLã‚’ä¿å­˜ã—ã¦æ§‹é€ ç¢ºèª
ls debug-output/<ID>_raw.html
```

### 2. ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºç‡ãŒä½ã„å ´åˆ

```bash
# Step 1: ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ä½œæˆ
pnpm debug:baseline

# Step 2: æ§‹é€ å¤‰åŒ–ã®ç¢ºèª
pnpm debug:compare

# Step 3: å…·ä½“çš„ãªå¤‰åŒ–ã®ç‰¹å®š
cat debug-output/change-reports/overall_report_*.json
```

### 3. æ–°ã—ã„ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã®èª¿æŸ»

ä¿å­˜ã•ã‚ŒãŸHTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã€DevToolsã§ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’èª¿æŸ»ï¼š

```bash
# HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜
pnpm debug:parser --product-id RJ123456

# ãƒ–ãƒ©ã‚¦ã‚¶ã§HTMLã‚’é–‹ã
open debug-output/RJ123456_raw.html
```

## ğŸ”§ ãƒ‘ãƒ¼ã‚µãƒ¼ä¿®æ­£ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### 1. å•é¡Œã®ç‰¹å®š

```bash
# ç¾çŠ¶ã®æŠŠæ¡
pnpm debug:quick

# è©³ç´°åˆ†æ
pnpm debug:parser --analyze-failures
```

### 2. HTMLæ§‹é€ ã®èª¿æŸ»

```bash
# æœ€æ–°HTMLã®ä¿å­˜
pnpm debug:parser --product-id <å•é¡Œã®ID>

# æ§‹é€ å¤‰åŒ–ã®ç¢ºèª
pnpm debug:compare
```

### 3. ãƒ‘ãƒ¼ã‚µãƒ¼ã‚³ãƒ¼ãƒ‰ã®ä¿®æ­£

å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«:
- `src/utils/dlsite-parser.ts` - åŸºæœ¬æƒ…å ±æŠ½å‡º
- `src/utils/dlsite-detail-parser.ts` - è©³ç´°æƒ…å ±æŠ½å‡º

### 4. ä¿®æ­£ã®æ¤œè¨¼

```bash
# ä¿®æ­£å¾Œã®ãƒ†ã‚¹ãƒˆ
pnpm debug:quick

# å•é¡ŒãŒè§£æ±ºã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
pnpm test
```

## ğŸ“ˆ æˆåŠŸæŒ‡æ¨™

### ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆã®ç†æƒ³çš„ãªçµæœ

- **æˆåŠŸç‡**: 80%ä»¥ä¸Š
- **ãƒˆãƒ©ãƒƒã‚¯æƒ…å ±æŠ½å‡º**: 60%ä»¥ä¸Š
- **ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±æŠ½å‡º**: 70%ä»¥ä¸Š  
- **ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼æƒ…å ±æŠ½å‡º**: 80%ä»¥ä¸Š
- **é«˜è§£åƒåº¦ç”»åƒå–å¾—**: 70%ä»¥ä¸Š

### è­¦å‘Šã‚µã‚¤ãƒ³

ä»¥ä¸‹ã®å ´åˆã¯ãƒ‘ãƒ¼ã‚µãƒ¼ä¿®æ­£ãŒå¿…è¦:

- æˆåŠŸç‡ < 50%
- "HTML too short" ã‚¨ãƒ©ãƒ¼ãŒå¤šç™º
- ç‰¹å®šã®ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—ãŒå…¨ãå–å¾—ã§ããªã„
- HTMLæ§‹é€ å¤‰åŒ–ç›£è¦–ã§å¤§å¹…ãªå¤‰æ›´ã‚’æ¤œå‡º

## ğŸ’¡ é–‹ç™ºã®ã‚³ãƒ„

### 1. ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã®å …ç‰¢æ€§å‘ä¸Š

```typescript
// æ‚ªã„ä¾‹: å˜ä¸€ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼
const title = $('.work_name a').text();

// è‰¯ã„ä¾‹: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä»˜ã
const title = $('.work_name a').text() || 
              $('.product-title').text() || 
              $('h1.title').text() || 
              '';
```

### 2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„

```typescript
try {
  const data = complexParsing();
  return data;
} catch (error) {
  logger.debug('Parsing failed, trying fallback method', { error });
  return fallbackParsing();
}
```

### 3. æ®µéšçš„ãªãƒ‡ãƒãƒƒã‚°

```typescript
// ãƒ‡ãƒãƒƒã‚°ç”¨ã®è©³ç´°ãƒ­ã‚°
logger.debug('HTML structure check', {
  hasMainTable: $('.work_1col_table').length > 0,
  rowCount: $('.work_1col_table tr').length,
  sampleText: $('.work_name').first().text().substring(0, 50)
});
```

## ğŸš€ å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### é€±æ¬¡ãƒã‚§ãƒƒã‚¯

```bash
# ãƒ‘ãƒ¼ã‚µãƒ¼ã®å¥å…¨æ€§ç¢ºèª
pnpm debug:quick

# HTMLæ§‹é€ ã®å¤‰åŒ–ç¢ºèª
pnpm debug:compare
```

### æœˆæ¬¡ãƒã‚§ãƒƒã‚¯

```bash
# ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã®æ›´æ–°
pnpm debug:baseline

# è©³ç´°ãªåˆ†æãƒ¬ãƒãƒ¼ãƒˆ
pnpm debug:parser --analyze-failures
```

## ğŸ†˜ ã‚µãƒãƒ¼ãƒˆ

ãƒ‘ãƒ¼ã‚µãƒ¼ã®å•é¡ŒãŒè§£æ±ºã—ãªã„å ´åˆ:

1. `debug-output/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
2. HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦DLsiteã®è¡¨ç¤ºã¨æ¯”è¼ƒ
3. æ–°ã—ã„ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç‰¹å®š
4. ãƒ‘ãƒ¼ã‚µãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’æ®µéšçš„ã«ä¿®æ­£
5. ãƒ†ã‚¹ãƒˆã§æ¤œè¨¼

---

**ä½œæˆæ—¥**: 2025å¹´7æœˆ3æ—¥  
**å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v0.2.6+  
**æ›´æ–°å‘¨æœŸ**: å¿…è¦ã«å¿œã˜ã¦