#!/bin/bash
# Claude Code Session Branch End Script

set -e

echo "ğŸ Ending Claude Code session..."

# Get current branch name
BRANCH=$(git branch --show-current)

# Ensure we're on a session branch
if [[ ! "$BRANCH" =~ ^session/ ]]; then
    echo "âŒ Error: Not on a session branch. Current branch: $BRANCH"
    echo "ğŸ’¡ Session branches should start with 'session/'"
    exit 1
fi

# Check if there are uncommitted changes
if ! git diff-index --quiet HEAD --; then
    echo "âš ï¸  Warning: You have uncommitted changes"
    echo "Please commit your changes before ending the session"
    git status --short
    exit 1
fi

echo "ğŸ“‹ Session branch: $BRANCH"

# Switch to main and merge
git checkout main
git merge --no-ff "$BRANCH"

# Delete session branch
git branch -d "$BRANCH"

echo "âœ… Session completed successfully!"
echo "ğŸ“ Changes merged to main branch"
echo "ğŸ—‘ï¸  Session branch deleted: $BRANCH"
echo ""
echo "ğŸ’¡ Next steps:"
echo "  - Run: git push origin main"
echo "  - Start new session: ./scripts/git-claude-start"